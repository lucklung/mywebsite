{% extends 'base.html'%}
{% block content%}

    <div class="container">
      <div class="text-center mb-4">
        <h1 class="display-5 fw-bold">Is Your Prompt Ethical?</h1>
        <p class="lead">
          Enter a prompt below and get instant feedback on how responsible and
          ethical it is before sending it to an AI.
        </p>
      </div>

      <div class="row justify-content-center mb-4">
        <div class="col-md-8">
          <div class="card shadow-sm">
            <div class="card-body">
              <form action="/evaluate" method="POST">
                <div class="mb-3">
                  <label for="prompt" class="form-label"
                    ><strong>Your Prompt:</strong></label
                  >
                  <textarea
                    id="prompt"
                    name="prompt"
                    class="form-control"
                    rows="6"
                    placeholder="e.g., 'Can you write my entire essay for me?'"
                  ></textarea>
                </div>
                <button type="submit" class="btn btn-primary w-100">
                  Analyze Prompt
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      <!-- Scores Section -->
      <div class="container mb-5">
        <div class="row row-cols-1 row-cols-md-5 g-3">
          {% for criterion, label in {
            'purpose_intent': 'Purpose and Intent',
            'autonomy_integrity': 'Autonomy and Integrity',
            'social_impact_harm': 'Social Impact / Harm',
            'clarity_specificity': 'Clarity and Specificity',
            'alignment_ai_ethics': 'AI Ethics Alignment'
          }.items() %}
          <div class="col">
            <div class="card text-center shadow-sm h-100">
              <div class="card-body d-flex flex-column justify-content-between">
                <div>
                  <h5 class="card-title">{{ label }}</h5>
                  <p
                    class="display-6 text-white py-2 px-3 rounded {{ scores[criterion]|get_color_class }}"
                  >
                    {{ scores[criterion] }} / 20
                  </p>
                </div>
                <div>
                  <button
                    class="btn btn-sm btn-outline-primary"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#explanation-{{ loop.index }}"
                  >
                    Why this score?
                  </button>
                  <div class="collapse mt-2" id="explanation-{{ loop.index }}">
                    <div class="card card-body small">
                      {{ explanations[criterion] if explanations and criterion in explanations else 'Explanation will appear here.' }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>

      <!-- Total Score + Feedback -->
      {% if scores['total_score'] is not none %}
      <div class="row mb-5">
        <div class="col-md-6">
          <div
            class="card text-center shadow-sm border-primary h-100 d-flex justify-content-center align-items-center"
            style="min-height: 160px"
          >
            <div class="card-body">
              <h5 class="card-title text-primary mb-2">üßÆ Total Score</h5>
              <p class="display-6">{{ scores['total_score'] }} / 100</p>
            </div>
          </div>
        </div>
        <div class="col-md-6">
          <div class="card shadow-sm border-info h-100">
            <div class="card-body">
              <h5 class="card-title text-info">Feedback</h5>
              <p class="small">{{ feedback }}</p>
            </div>
          </div>
        </div>
      </div>
      {% endif %}

      <!-- Example Prompts -->
      <div class="mt-5 text-center">
        <h5>üîç Example Prompts:</h5>
        <p>
          <span class="text-danger"><strong>Unethical:</strong></span>
          "Write my essay for me"
        </p>
        <p>
          <span class="text-success"><strong>Ethical:</strong></span>
          "Can you help brainstorm arguments for an essay on climate change?"
        </p>
      </div>

      <!-- Criteria Accordion -->
      <div class="container mt-4 mb-5 pb-5">
        <h4 class="mb-3">Scoring Criteria</h4>
        <div class="accordion" id="criteriaAccordion">
          {% set criteria = [
            ("purpose_intent", "Purpose & Intent", "Is the prompt aimed at learning, curiosity, or productivity (vs cheating or harm)?"),
            ("autonomy_integrity", "Autonomy & Integrity", "Does it respect the user's own role (not 'do it for me' but 'help me understand')?"),
            ("social_impact_harm", "Social Impact / Harm", "Could the output cause harm, spread misinformation, or promote bias?"),
            ("clarity_specificity", "Clarity & Specificity", "Is the prompt well-defined and constructive for AI to answer responsibly?"),
            ("alignment_ai_ethics", "AI Ethics Alignment", "Does it reflect responsible AI use (transparency, fairness, accountability)?")
          ] %}
          {% for key, label, desc in criteria %}
          <div class="accordion-item">
            <h2 class="accordion-header">
              <button
                class="accordion-button collapsed"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#criteria{{ loop.index }}"
              >
                {{ label }}
              </button>
            </h2>
            <div
              id="criteria{{ loop.index }}"
              class="accordion-collapse collapse"
              data-bs-parent="#criteriaAccordion"
            >
              <div class="accordion-body">{{ desc }}</div>
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
{% endblock%}
